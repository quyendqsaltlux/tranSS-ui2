<div class="row assignment-container">
  <div class="col-sm-12">
    <div class="card mb-1">
      <div class="card-body" [ngClass]="{'new-pro-assignment': !assignment || !assignment.id}">
        <fieldset [disabled]="!viewControl.ableToChange">
          <form #f="ngForm" (ngSubmit)="onSubmit()" novalidate>
            <div class="d-flex">
              <div class="d-flex flex-grow-1 justify-content-between">
                <div class="d-flex">
                  <div class="resource-search mr-1 ml-1">
                    <app-project-resoure-search [model]="model"
                                                [f]="f"
                                                [viewControl]="viewControl"
                                                (selectTaskSourceTarget)="onSelectTaskSourceTarget($event)">
                    </app-project-resoure-search>
                  </div>
                  <div class="card card-body mr-1 ml-1 mb-0">
                    <!--ROW 2-->
                    <div class="d-flex form-left">
                      <div class="form-group w80">
                        <label for="reprep">Rep.</label>
                        <input type="number" class=" form-control form-control-sm" id="reprep" name="reprep"
                               [(ngModel)]="model.reprep" #reprep="ngModel" min="0" max="100" required
                               (ngModelChange)="onRepInputChanged()"
                               [ngClass]="{'is-invalid': f.submitted && reprep.invalid}">
                        <div *ngIf="reprep.invalid && (reprep.dirty || reprep.touched)" class="msg-invalid">
                          <div *ngIf="reprep.errors.required">Required</div>
                        </div>
                      </div>
                      <div class="form-group w80">
                        <label for="rep100">Rep 100 %</label>
                        <input type="number" class=" form-control form-control-sm" id="rep100" name="rep100"
                               [(ngModel)]="model.rep100" #rep100="ngModel" min="0" max="100"
                               (ngModelChange)="onRepInputChanged()">
                        <div *ngIf="rep100.invalid && (rep100.dirty || rep100.touched)" class="msg-invalid">
                          <div *ngIf="rep100.errors.required">Required</div>
                        </div>
                      </div>
                      <div class="form-group w80">
                        <label for="rep99_95">Rep 99~95 %</label>
                        <input type="number" class=" form-control form-control-sm" id="rep99_95" name="rep99_95"
                               [(ngModel)]="model.rep99_95" #rep99_95="ngModel" min="0" max="100"
                               (ngModelChange)="onRepInputChanged()">
                        <div *ngIf="rep99_95.invalid && (rep99_95.dirty || rep99_95.touched)" class="msg-invalid">
                          <div *ngIf="rep99_95.errors.required">Required</div>
                        </div>
                      </div>
                      <div class="form-group w80">
                        <label for="rep94_85">Rep 94~85 %</label>
                        <input type="number" class=" form-control form-control-sm" id="rep94_85" name="rep94_85"
                               [(ngModel)]="model.rep94_85" #rep94_85="ngModel" min="0" max="100"
                               (ngModelChange)="onRepInputChanged()">
                        <div *ngIf="rep94_85.invalid && (rep94_85.dirty || rep94_85.touched)" class="msg-invalid">
                          <div *ngIf="rep94_85.errors.required">Required</div>
                        </div>
                      </div>
                      <div class="form-group w80">
                        <label for="rep84_75">Rep 84~75 %</label>
                        <input type="number" class=" form-control form-control-sm" id="rep84_75" name="rep84_75"
                               [(ngModel)]="model.rep84_75" #rep84_75="ngModel" min="0" max="100"
                               (ngModelChange)="onRepInputChanged()">
                        <div *ngIf="rep84_75.invalid && (rep84_75.dirty || rep84_75.touched)" class="msg-invalid">
                          <div *ngIf="rep84_75.errors.required">Required</div>
                        </div>
                      </div>
                      <div class="form-group w80">
                        <label for="repnoMatch">New/Hour</label>
                        <input type="number" class=" form-control form-control-sm" id="repnoMatch" name="repnoMatch"
                               [(ngModel)]="model.repnoMatch" #repnoMatch="ngModel" min="0"
                               (ngModelChange)="onRepInputChanged()">
                        <div *ngIf="repnoMatch.invalid && (repnoMatch.dirty || repnoMatch.touched)" class="msg-invalid">
                          <div *ngIf="repnoMatch.errors.required">Required</div>
                        </div>
                      </div>
                      <div class="form-group w80">
                        <label for="totalRep">Total Rep</label>
                        <input type="number" readonly class="form-control form-control-sm" id="totalRep" name="totalRep"
                               [(ngModel)]="model.totalRep" #repnoMatch="ngModel">
                      </div>

                      <div class="form-group w80">
                        <label for="unitPrice">Unit price</label>
                        <input type="number" class=" form-control form-control-sm" id="unitPrice" name="unitPrice"
                               [(ngModel)]="model.unitPrice" #unitPrice="ngModel" min="0" max="100" required
                               (ngModelChange)="onUnitPriceChanged()" [readonly]="!model.externalResource"
                               [ngClass]="{'is-invalid': f.submitted && unitPrice.invalid}">
                        <div *ngIf="unitPrice.invalid && (unitPrice.dirty || unitPrice.touched)" class="msg-invalid">
                          <div *ngIf="unitPrice.errors.required">Required</div>
                        </div>
                      </div>
                    </div>

                    <!--ROW 3-->
                    <div class="d-flex form-left">
                      <div class="form-group w80">
                        <label for="wrep">Wf Rep.</label>
                        <input type="number" class=" form-control form-control-sm" id="wrep" name="wrep"
                               (ngModelChange)="onWfInputChanged()"
                               [(ngModel)]="model.wrep" #wrep="ngModel" min="0" max="100">
                      </div>
                      <div class="form-group w80">
                        <label for="w100">Wf 100</label>
                        <input type="number" class=" form-control form-control-sm" id="w100" name="w100"
                               (ngModelChange)="onWfInputChanged()"
                               [(ngModel)]="model.w100" #w100="ngModel" min="0" max="100">
                      </div>
                      <div class="form-group w80">
                        <label for="w99_95">Wf 99~95</label>
                        <input type="number" class=" form-control form-control-sm" id="w99_95" name="w99_95"
                               [readonly]="!model.useCustomTask && !model.externalResource" (ngModelChange)="onWfInputChanged()"
                               [(ngModel)]="model.w99_95" #w99_95="ngModel" min="0" max="100">
                      </div>
                      <div class="form-group w80">
                        <label for="w94_85">Wf 94~85</label>
                        <input type="number" class=" form-control form-control-sm" id="w94_85" name="w94_85"
                               [readonly]="!model.useCustomTask && !model.externalResource" (ngModelChange)="onWfInputChanged()"
                               [(ngModel)]="model.w94_85" #w94_85="ngModel" min="0" max="100">
                      </div>
                      <div class="form-group w80">
                        <label for="w84_75">Wf 84~75</label>
                        <input type="number" class=" form-control form-control-sm" id="w84_75" name="w84_75"
                               [readonly]="!model.useCustomTask && !model.externalResource" (ngModelChange)="onWfInputChanged()"
                               [(ngModel)]="model.w84_75" #w84_75="ngModel" min="0" max="100">
                      </div>
                      <div class="form-group w80">
                        <label for="wnoMatch">Wf New</label>
                        <input type="number" class=" form-control form-control-sm" id="wnoMatch" name="wnoMatch"
                               [readonly]="!model.useCustomTask && !model.externalResource" (ngModelChange)="onWfInputChanged()"
                               [(ngModel)]="model.wnoMatch" #wnoMatch="ngModel" min="0" max="100">
                      </div>
                      <div class="form-group w80">
                        <label for="netOrHour">Net/Hour</label>
                        <input type="number" [readonly]="isComputeNetHourManually()"
                               class="form-control form-control-sm" id="netOrHour" name="netOrHour"
                               (ngModelChange)="onNetOrHourChanged()" min="0"
                               [(ngModel)]="model.netOrHour" #repnoMatch="ngModel">
                      </div>
                      <!--TOTAL-->
                      <div class="form-group w80">
                        <label for="total">Total<span class="text-danger"> *</span></label>
                        <input type="number" class=" form-control form-control-sm" id="total" name="total"
                               required min="0" readonly
                               [(ngModel)]="model.total" #total="ngModel">
                      </div>
                    </div>

                    <!--CONFIG ROW-->
                    <div class="d-flex form-left">

                      <div class="form-group ml-1 mr-1">
                        <label for="netOrHour">Compute Net/Hour manually</label>
                        <div>
                          <label class="ml-1 switch switch-sm switch-primary">
                            <input type="checkbox" class="switch-input" name="notAutoComputeNetHour" [(ngModel)]="model.notAutoComputeNetHour"
                                   (change)="onToggleAutoComputeNetOrHour()">
                            <span class="switch-slider"></span>
                          </label>
                        </div>
                      </div>
                      <!--Request date-->
                      <div class="form-group date">
                        <label for="ho">HO<span class="text-danger"> *</span></label>
                        <input type="date" class=" form-control form-control-sm" required id="ho" name="ho" [(ngModel)]="model.ho">
                      </div>
                      <!--Request date-->
                      <div class="form-group date">
                        <label for="hb">HB<span class="text-danger"> *</span></label>
                        <input type="date" class=" form-control form-control-sm" required id="hb" name="hb" [(ngModel)]="model.hb">
                      </div>
                      <!--ASSIGN BTN-->
                      <div class="form-group w80">
                        <label><span class="invisible">.</span></label>
                        <div>
                          <button type="submit" class="btn btn-sm btn-primary text-nowrap" [disabled]="f.invalid">Assign <i class="fa fa-arrow-right"></i></button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <!--CONFIRM STATUS & PROGRESS-->
                <div class="card card-body mb-0">
                  <div class="" *ngIf="assignment && assignment.id">
                    <h6>Progress</h6>
                    <ul class="timeline">
                      <li *ngFor="let myStone of progress; let index=index" [class.active-timeline]="progressDigit[model.progress] >= myStone.id">
                        <a class="cursor-pointer" (click)="onClickStone(myStone)">{{myStone.label}}</a>
                      </li>
                    </ul>
                    <!--DELETE EVALUATE-->
                    <div class="d-flex justify-content-between">
                      <div>
                        <button type="button" class="btn btn-sm btn-ghost-light" (click)="onDeleteResource()">
                          <i class="fa fa-trash-o text-danger"></i>
                        </button>
                        <button type="button" class=" btn btn-sm btn-ghost-light" (click)="goToPo(assignment.id, assignment.poId)">
                          <i class="fa fa-dollar text-success"> PO</i>
                        </button>
                      </div>
                      <div class="cursor-pointer" *ngIf="assignment.progress === 'FINISHED'" (click)="openNewGeneralCommentModal()">
                        <button type="button" class="btn btn-ghost-light btn-sm p-0" *ngIf="!assignment.star">Evaluate</button>
                        <ng-container *ngIf="assignment.star && assignment.star > 0">
                          <span>{{assignment.star}} <i class="fa fa-star text-warning"></i></span>
                        </ng-container>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </form>
        </fieldset>
      </div>
    </div>
  </div>
</div>
