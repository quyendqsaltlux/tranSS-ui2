<div class="row assignment-container">
  <div class="col-sm-12">
    <div class="card mb-1">
      <div class="card-body p-1" [ngClass]="{'new-pro-assignment': !assignment || !assignment.id}">
        <fieldset [disabled]="!viewControl.ableToChange">
          <form #f="ngForm" (ngSubmit)="onSubmit()" novalidate>
            <div class="d-flex">
              <div class="d-flex flex-grow-1 justify-content-between">
                <div class="d-flex">
                  <div class="resource-search mr-1 ml-1">
                    <app-project-resoure-search [model]="model"
                                                [f]="f"
                                                [viewControl]="viewControl"
                                                (selectTaskSourceTarget)="onSelectTaskSourceTarget($event)">
                    </app-project-resoure-search>
                  </div>
                  <div class="card card-body  mr-1 ml-1 mb-0">
                    <!--ROW 2-->
                    <div class="d-flex form-left">
                      <div class="form-group w80">
                        <label for="reprep">Rep.</label>
                        <input type="number" class=" form-control form-control-sm" id="reprep" name="reprep"
                               [(ngModel)]="model.reprep" #reprep="ngModel" min="0" max="100" required
                               (ngModelChange)="onRepInputChanged()"
                               [ngClass]="{'is-invalid': f.submitted && reprep.invalid}">
                        <div *ngIf="reprep.invalid && (reprep.dirty || reprep.touched)" class="msg-invalid">
                          <div *ngIf="reprep.errors.required">Required</div>
                        </div>
                      </div>
                      <div class="form-group w80">
                        <label for="rep100">Rep 100 %</label>
                        <input type="number" class=" form-control form-control-sm" id="rep100" name="rep100"
                               [(ngModel)]="model.rep100" #rep100="ngModel" min="0" max="100"
                               (ngModelChange)="onRepInputChanged()">
                        <div *ngIf="rep100.invalid && (rep100.dirty || rep100.touched)" class="msg-invalid">
                          <div *ngIf="rep100.errors.required">Required</div>
                        </div>
                      </div>
                      <div class="form-group w80">
                        <label for="rep99_95">Rep 99~95 %</label>
                        <input type="number" class=" form-control form-control-sm" id="rep99_95" name="rep99_95"
                               [(ngModel)]="model.rep99_95" #rep99_95="ngModel" min="0" max="100"
                               (ngModelChange)="onRepInputChanged()">
                        <div *ngIf="rep99_95.invalid && (rep99_95.dirty || rep99_95.touched)" class="msg-invalid">
                          <div *ngIf="rep99_95.errors.required">Required</div>
                        </div>
                      </div>
                      <div class="form-group w80">
                        <label for="rep94_85">Rep 94~85 %</label>
                        <input type="number" class=" form-control form-control-sm" id="rep94_85" name="rep94_85"
                               [(ngModel)]="model.rep94_85" #rep94_85="ngModel" min="0" max="100"
                               (ngModelChange)="onRepInputChanged()">
                        <div *ngIf="rep94_85.invalid && (rep94_85.dirty || rep94_85.touched)" class="msg-invalid">
                          <div *ngIf="rep94_85.errors.required">Required</div>
                        </div>
                      </div>
                      <div class="form-group w80">
                        <label for="rep84_75">Rep 84~75 %</label>
                        <input type="number" class=" form-control form-control-sm" id="rep84_75" name="rep84_75"
                               [(ngModel)]="model.rep84_75" #rep84_75="ngModel" min="0" max="100"
                               (ngModelChange)="onRepInputChanged()">
                        <div *ngIf="rep84_75.invalid && (rep84_75.dirty || rep84_75.touched)" class="msg-invalid">
                          <div *ngIf="rep84_75.errors.required">Required</div>
                        </div>
                      </div>
                      <div class="form-group w80">
                        <label for="repnoMatch">New/Hour</label>
                        <input type="number" class=" form-control form-control-sm" id="repnoMatch" name="repnoMatch"
                               [(ngModel)]="model.repnoMatch" #repnoMatch="ngModel" min="0"
                               (ngModelChange)="onRepInputChanged()">
                        <div *ngIf="repnoMatch.invalid && (repnoMatch.dirty || repnoMatch.touched)" class="msg-invalid">
                          <div *ngIf="repnoMatch.errors.required">Required</div>
                        </div>
                      </div>
                      <div class="form-group w80">
                        <label for="totalRep">Total Rep</label>
                        <input type="number" readonly class="form-control form-control-sm" id="totalRep" name="totalRep"
                               [(ngModel)]="model.totalRep" #repnoMatch="ngModel">
                      </div>

                      <div class="form-group w80">
                        <label for="unitPrice">Unit price</label>
                        <input type="number" class=" form-control form-control-sm" id="unitPrice" name="unitPrice"
                               [(ngModel)]="model.unitPrice" #unitPrice="ngModel" min="0" max="100" required
                               (ngModelChange)="onUnitPriceChanged()" [readonly]="!model.externalResource"
                               [ngClass]="{'is-invalid': f.submitted && unitPrice.invalid}">
                        <div *ngIf="unitPrice.invalid && (unitPrice.dirty || unitPrice.touched)" class="msg-invalid">
                          <div *ngIf="unitPrice.errors.required">Required</div>
                        </div>
                      </div>
                    </div>

                    <!--ROW 3-->
                    <div class="d-flex form-left">
                      <div class="form-group w80">
                        <label for="wrep">Wf Rep.</label>
                        <input type="number" class=" form-control form-control-sm" id="wrep" name="wrep"
                               (ngModelChange)="onWfInputChanged()"
                               [(ngModel)]="model.wrep" #wrep="ngModel" min="0" max="100">
                      </div>
                      <div class="form-group w80">
                        <label for="w100">Wf 100</label>
                        <input type="number" class=" form-control form-control-sm" id="w100" name="w100"
                               (ngModelChange)="onWfInputChanged()"
                               [(ngModel)]="model.w100" #w100="ngModel" min="0" max="100">
                      </div>
                      <div class="form-group w80">
                        <label for="w99_95">Wf 99~95</label>
                        <input type="number" class=" form-control form-control-sm" id="w99_95" name="w99_95"
                               [readonly]="!model.useCustomTask && !model.externalResource" (ngModelChange)="onWfInputChanged()"
                               [(ngModel)]="model.w99_95" #w99_95="ngModel" min="0" max="100">
                      </div>
                      <div class="form-group w80">
                        <label for="w94_85">Wf 94~85</label>
                        <input type="number" class=" form-control form-control-sm" id="w94_85" name="w94_85"
                               [readonly]="!model.useCustomTask && !model.externalResource" (ngModelChange)="onWfInputChanged()"
                               [(ngModel)]="model.w94_85" #w94_85="ngModel" min="0" max="100">
                      </div>
                      <div class="form-group w80">
                        <label for="w84_75">Wf 84~75</label>
                        <input type="number" class=" form-control form-control-sm" id="w84_75" name="w84_75"
                               [readonly]="!model.useCustomTask && !model.externalResource" (ngModelChange)="onWfInputChanged()"
                               [(ngModel)]="model.w84_75" #w84_75="ngModel" min="0" max="100">
                      </div>
                      <div class="form-group w80">
                        <label for="wnoMatch">Wf New</label>
                        <input type="number" class=" form-control form-control-sm" id="wnoMatch" name="wnoMatch"
                               [readonly]="!model.useCustomTask && !model.externalResource" (ngModelChange)="onWfInputChanged()"
                               [(ngModel)]="model.wnoMatch" #wnoMatch="ngModel" min="0" max="100">
                      </div>
                      <div class="form-group w80">
                        <label for="netOrHour">Net/Hour</label>
                        <input type="number" [readonly]="isComputeNetHourManually()"
                               class="form-control form-control-sm" id="netOrHour" name="netOrHour"
                               (ngModelChange)="onNetOrHourChanged()" min="0"
                               [(ngModel)]="model.netOrHour" #repnoMatch="ngModel">
                      </div>
                      <!--TOTAL-->
                      <div class="form-group w80">
                        <label for="total">Total<span class="text-danger"> *</span></label>
                        <input type="number" class=" form-control form-control-sm" id="total" name="total"
                               required min="0" readonly
                               [(ngModel)]="model.total" #total="ngModel">
                      </div>
                    </div>

                    <!--CONFIG ROW-->
                    <div class="d-flex form-left">

                      <div class="form-group ml-1 mr-1">
                        <label for="netOrHour">Compute Net/Hour manually</label>
                        <div>
                          <label class="ml-1 switch switch-sm switch-primary">
                            <input type="checkbox" class="switch-input" name="notAutoComputeNetHour" [(ngModel)]="model.notAutoComputeNetHour"
                                   (change)="onToggleAutoComputeNetOrHour()">
                            <span class="switch-slider"></span>
                          </label>
                        </div>
                      </div>
                      <!--Request date-->
                      <div class="form-group date">
                        <label for="ho">HO<span class="text-danger"> *</span></label>
                        <input type="date" class=" form-control form-control-sm" required id="ho" name="ho" [(ngModel)]="model.ho">
                      </div>
                      <!--Request date-->
                      <div class="form-group date">
                        <label for="hb">HB<span class="text-danger"> *</span></label>
                        <input type="date" class=" form-control form-control-sm" required id="hb" name="hb" [(ngModel)]="model.hb">
                      </div>
                      <!--ASSIGN BTN-->
                      <div class="form-group w80">
                        <label><span class="invisible">.</span></label>
                        <div>
                          <button type="submit" class="btn btn-sm btn-primary text-nowrap" [disabled]="f.invalid">Assign <i class="fa fa-arrow-right"></i></button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <!--CONFIRM STATUS & PROGRESS-->
                <div class="d-flex mr-5" *ngIf="assignment && assignment.id">
                  <!--STATUS-->
                  <div class="media mr-2" *ngIf="assignment && assignment.candidate">
                    <div class="media-body">
                      <H6 class="mt-0 mb-1 text-primary" title="{{assignment.candidate.name}}">{{assignment.candidate.name | lmTo: 20}}</H6>
                      <!--STATUS-->
                      <div class="btn-group btn-group-sm mt-1 pull-right" dropdown>
                        <button type="button" class="btn btn-sm text-nowrap"
                                [class.btn-dark]="assignment.status === 'NOT_CONFIRMED'"
                                [class.btn-success]="assignment.status === 'CONFIRMED'">
                          {{assignment.status | assignmentStatus}}
                        </button>
                        <button type="button" dropdownToggle class="btn dropdown-toggle dropdown-toggle-split"
                                [class.btn-dark]="assignment.status === 'NOT_CONFIRMED'"
                                [class.btn-success]="assignment.status === 'CONFIRMED'">
                          <span class="caret"></span>
                        </button>
                        <ul *dropdownMenu class="dropdown-menu" role="menu">
                          <li role="menuitem"><a class="dropdown-item cursor-pointer" (click)="onChangeConfirmStatus('NOT_CONFIRMED')">Not confirmed</a></li>
                          <li role="menuitem"><a class="dropdown-item cursor-pointer" (click)="onChangeConfirmStatus('CONFIRMED')">Confirmed</a></li>
                        </ul>
                      </div>
                    </div>
                    <!--AVATAR-->
                    <!--<img *ngIf="assignment.candidate.avatar" class="mr-3" [src]="assignment.candidate.avatar" alt="Avatar" width="40" height="40">-->
                    <!--<img *ngIf="!assignment.candidate.avatar" class="mr-3" src="assets/img/avatars/default_avatar.png" alt="Avatar" width="40" height="40">-->
                  </div>
                  <!--PROGRESS-->
                  <div class="form-group ml-2 mb-0">
                    <label>Progress</label>
                    <div>
                      <div class="btn-group btn-group-sm" dropdown placement="bottom right">
                        <button type="button" class="btn btn-sm text-nowrap"
                                [class.btn-dark]="assignment.progress === 'NOT_START'"
                                [class.btn-warning]="assignment.progress === 'ON_GOING'"
                                [class.btn-success]="assignment.progress === 'FINISHED'">
                          {{assignment.progress | progress}}
                        </button>
                        <button type="button" dropdownToggle class="btn dropdown-toggle dropdown-toggle-split"
                                [class.btn-dark]="assignment.progress === 'NOT_START'"
                                [class.btn-warning]="assignment.progress === 'ON_GOING'"
                                [class.btn-success]="assignment.progress === 'FINISHED'">
                          <span class="caret"></span>
                        </button>
                        <ul *dropdownMenu class="dropdown-menu dropdown-menu-right" role="menu">
                          <li role="menuitem"><a class="dropdown-item cursor-pointer" (click)="onChangeProgress('NOT_START')">Not start</a></li>
                          <li role="menuitem"><a class="dropdown-item cursor-pointer" (click)="onChangeProgress('ON_GOING')">On going</a></li>
                          <li role="menuitem"><a class="dropdown-item cursor-pointer" (click)="onChangeProgress('FINISHED')">Finished</a></li>
                        </ul>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <!--RIGHT TOOLBAR-->
              <div class="right-actions">
                <button type="button" class="btn-ghost-secondary" (click)="onDeleteResource()">
                  <i class="fa fa-trash-o text-danger"></i></button>
                <div class="cursor-pointer d-flex justify-content-end" *ngIf="assignment.progress === 'FINISHED'" (click)="openNewGeneralCommentModal()">
                  <button type="button" class="btn btn-ghost-primary btn-sm p-0" *ngIf="!assignment.star">Evaluate</button>
                  <ng-container *ngIf="assignment.star && assignment.star > 0">
                    <span>{{assignment.star}} <i class="fa fa-star text-warning"></i></span>
                  </ng-container>
                </div>
                <button type="button" class="btn-ghost-secondary" (click)="goToPo(assignment.id)">
                  <i class="fa fa-dollar text-success"></i></button>
              </div>
            </div>
          </form>
        </fieldset>
      </div>
    </div>
  </div>
</div>
